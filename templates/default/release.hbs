<div class="container">
  <nav class="breadcrumb">
    <a href="{{path backUrl}}">← Back to catalog</a>
  </nav>

  <article class="release-detail">
    <header class="release-header">
      {{#if release.coverUrl}}
      <div class="release-cover-large">
        <img src="{{path release.coverUrl}}" alt="{{release.config.title}}">
      </div>
      {{/if}}
      
      <div class="release-metadata">
        <h1>{{release.config.title}}</h1>
        
        {{#if artist}}
        <p class="release-artist">by {{artist.name}}</p>
        {{/if}}
        
        <p class="release-date">Released {{formatDate release.config.date}}</p>
        
        {{#if release.config.genres}}
        <div class="release-genres">
          {{#each release.config.genres}}
          <span class="genre-tag">{{this}}</span>
          {{/each}}
        </div>
        {{/if}}
        
        {{#if release.config.description}}
        <p class="release-description">{{release.config.description}}</p>
        {{/if}}
        
        {{#if release.config.credits}}
        <div class="release-credits">
          <h3>Credits</h3>
          <ul>
            {{#each release.config.credits}}
            <li><strong>{{role}}:</strong> {{name}}</li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
        
        {{#if release.config.license}}
        <div class="release-license">
          <h3>License</h3>
          <p class="license-info">
            {{#if (eq release.config.license "copyright")}}
            <i class="fas fa-copyright"></i> All rights reserved. This work is protected by copyright.
            {{else if (eq release.config.license "cc-by")}}
            <i class="fab fa-creative-commons"></i> Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a> - Attribution
            {{else if (eq release.config.license "cc-by-sa")}}
            <i class="fab fa-creative-commons"></i> Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a> - Attribution-ShareAlike
            {{else if (eq release.config.license "cc-by-nc")}}
            <i class="fab fa-creative-commons"></i> Licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a> - Attribution-NonCommercial
            {{else if (eq release.config.license "cc-by-nc-sa")}}
            <i class="fab fa-creative-commons"></i> Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> - Attribution-NonCommercial-ShareAlike
            {{else if (eq release.config.license "cc-by-nc-nd")}}
            <i class="fab fa-creative-commons"></i> Licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> - Attribution-NonCommercial-NoDerivatives
            {{else if (eq release.config.license "cc-by-nd")}}
            <i class="fab fa-creative-commons"></i> Licensed under <a href="https://creativecommons.org/licenses/by-nd/4.0/" target="_blank">CC BY-ND 4.0</a> - Attribution-NoDerivatives
            {{else if (eq release.config.license "public-domain")}}
            <i class="fas fa-globe"></i> Public Domain - This work is in the public domain.
            {{/if}}
          </p>
        </div>
        {{/if}}
        
        {{#if release.config.download}}
        <div class="release-download-actions">
          {{#if (eq release.config.download "free")}}
          <button class="btn btn-primary" onclick="downloadAll()">
            <i class="fas fa-download"></i> Download All (Free)
          </button>
          {{else if (eq release.config.download "paycurtain")}}
          <div class="paycurtain">
            <div class="support-message">
              <p><strong>Support the artist!</strong></p>
              <p>Suggested donation: ${{release.config.price}}</p>
              <p class="honor-system">This is an honor system - you can download for free, but your support helps the artist continue creating music.</p>
            </div>
            <div class="payment-buttons">
              {{#if release.config.paypalLink}}
              <a href="{{release.config.paypalLink}}" target="_blank" class="btn btn-primary">
                <i class="fab fa-paypal"></i> Support via PayPal
              </a>
              {{/if}}
              {{#if release.config.stripeLink}}
              <a href="{{release.config.stripeLink}}" target="_blank" class="btn btn-secondary">
                <i class="fab fa-stripe"></i> Support via Stripe
              </a>
              {{/if}}
              <button class="btn btn-outline" onclick="downloadAll()">
                <i class="fas fa-download"></i> Download Free
              </button>
              {{#unless release.config.paypalLink}}
              {{#unless release.config.stripeLink}}
              <p class="payment-info">No payment links configured - download is free</p>
              {{/unless}}
              {{/unless}}
            </div>
          </div>
          {{/if}}
        </div>
        {{/if}}
      </div>
    </header>
    
    <section class="tracklist">
      <h2>Tracks</h2>
      
      <div class="audio-player" id="audioPlayer">
        <div class="player-track-info">
          <div class="player-cover">
            {{#if release.coverUrl}}
            <img src="{{release.coverUrl}}" alt="{{release.config.title}}" id="playerCover">
            {{else}}
            <i class="fas fa-music"></i>
            {{/if}}
          </div>
          <div class="player-details">
            <div class="player-title" id="playerTitle">Select a track</div>
            <div class="player-artist" id="playerArtist">{{#if artist}}{{artist.name}}{{/if}}</div>
          </div>
        </div>
        
        <div class="player-controls">
          <button class="player-btn" id="prevBtn"><i class="fas fa-step-backward"></i></button>
          <button class="player-btn player-btn-play" id="playBtn">
            <i class="fas fa-play"></i>
          </button>
          <button class="player-btn" id="nextBtn"><i class="fas fa-step-forward"></i></button>
        </div>
        
        <div class="player-progress">
          <span class="player-time" id="currentTime">0:00</span>
          <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
          <span class="player-time" id="duration">0:00</span>
        </div>
        
        <div class="player-volume">
          <i class="fas fa-volume-up"></i>
          <input type="range" class="volume-bar" id="volumeBar" min="0" max="100" value="80">
        </div>
      </div>
      
      <ol class="track-list">
        {{#each release.tracks}}
        <li class="track-item" data-src="{{releasePath url}}" data-index="{{@index}}">
          <div class="track-number">{{@index}}</div>
          <div class="track-info">
            <div class="track-title">{{title}}</div>
            <div class="track-meta">
              {{formatAudioFormat filename}}
              {{#if duration}}
              · {{formatDuration duration}}
              {{/if}}
            </div>
          </div>
          <div class="track-actions">
            <button class="track-play-btn" onclick="playTrack({{@index}})">
              <i class="fas fa-play"></i>
            </button>
            {{#if ../release.config.download}}
            {{#if (eq ../release.config.download "free")}}
            <a href="{{releasePath url}}" download class="track-download-btn">
              <i class="fas fa-download"></i>
            </a>
            {{/if}}
            {{/if}}
          </div>
        </li>
        {{/each}}
      </ol>
    </section>
    
    {{#if artist.donationLinks}}
    <section class="donation-section">
      <h2>Support the Artist</h2>
      <p>If you enjoyed this music, consider supporting the artist:</p>
      <div class="donation-links">
        {{#each artist.donationLinks}}
        <a href="{{url}}" target="_blank" class="donation-link">
          <i class="fas fa-heart"></i>
          <span>{{platform}}</span>
          {{#if description}}
          <small>{{description}}</small>
          {{/if}}
        </a>
        {{/each}}
      </div>
    </section>
    {{/if}}
  </article>
</div>

<script>
  // Initialize player with tracks
  window.tracks = [
    {{#each release.tracks}}
    {
      url: '{{releasePath url}}',
      title: '{{title}}',
      artist: '{{#if artist}}{{artist}}{{else}}{{../artist.name}}{{/if}}',
      duration: {{#if duration}}{{duration}}{{else}}0{{/if}}
    }{{#unless @last}},{{/unless}}
    {{/each}}
  ];
</script>

